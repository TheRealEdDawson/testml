#!/bin/bash

# shellcheck disable=1090,2034

set -e

testml-run-file() {
  # set -x
  MIX_QUIET=1 \
  MIX_PATH="$TESTML_ROOT_LIB:$TESTML_LIB${MIX_PATH:+:$MIX_PATH}" \
    "$TESTML_LANG_BIN" \
      run -e "TestML.Run.Tap.run('$1')"
}

[[ -n $TESTML_SOURCED ]] ||
  source "${TESTML_ROOT:-$(dirname "$0")/..}/bin/testml"

source-testml-config

: "${TESTML_BIN:=testml-elixir-tap}"
: "${TESTML_LANG:=elixir}"
: "${TESTML_LANG_BIN:=mix}"
: "${TESTML_MODULE:=TestML.Run.Tap}"
: "${TESTML_BRIDGE:=testml-bridge}"

export TESTML_{BIN,BRIDGE,LANG{,_BIN},LIB,MODULE,PATH,RUN}

testml_runner_sourced=true

[[ $0 != "${BASH_SOURCE[0]}" ]] || testml-run "$@"

